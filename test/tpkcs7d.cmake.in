
message(NOTICE "testing pkcs7 conversions (2)")
execute_process(COMMAND @CMAKE_COMMAND@ -E copy @CMAKE_SOURCE_DIR@/openssl/test/pkcs7-1.pem @CMAKE_CURRENT_BINARY_DIR@/p7d-fff.p
                WORKING_DIRECTORY @CMAKE_CURRENT_BINARY_DIR@
                COMMAND_ERROR_IS_FATAL ANY
)

# why doesn't original p7d script use loop?

message(NOTICE "p -> d")
execute_process(COMMAND @CMAKE_BINARY_DIR@/apps/openssl pkcs7 -in p7d-fff.p -inform p -outform d
                WORKING_DIRECTORY @CMAKE_CURRENT_BINARY_DIR@
                OUTPUT_FILE p7d-f.d
                COMMAND_ERROR_IS_FATAL ANY
)

message(NOTICE "p -> p")
execute_process(COMMAND @CMAKE_BINARY_DIR@/apps/openssl pkcs7 -in p7d-fff.p -inform p -outform p
                WORKING_DIRECTORY @CMAKE_CURRENT_BINARY_DIR@
                OUTPUT_FILE p7d-f.p
                COMMAND_ERROR_IS_FATAL ANY
)

message(NOTICE "d -> d")
execute_process(COMMAND @CMAKE_BINARY_DIR@/apps/openssl pkcs7 -in p7d-f.d -inform d -outform d
                WORKING_DIRECTORY @CMAKE_CURRENT_BINARY_DIR@
                OUTPUT_FILE p7d-ff.d1
                COMMAND_ERROR_IS_FATAL ANY
)

message(NOTICE "p -> d")
execute_process(COMMAND @CMAKE_BINARY_DIR@/apps/openssl pkcs7 -in p7d-f.p -inform p -outform d
                WORKING_DIRECTORY @CMAKE_CURRENT_BINARY_DIR@
                OUTPUT_FILE p7d-ff.d3
                COMMAND_ERROR_IS_FATAL ANY
)

message(NOTICE "d -> p")
execute_process(COMMAND @CMAKE_BINARY_DIR@/apps/openssl pkcs7 -in p7d-f.d -inform d -outform p
                WORKING_DIRECTORY @CMAKE_CURRENT_BINARY_DIR@
                OUTPUT_FILE p7d-ff.p1
                COMMAND_ERROR_IS_FATAL ANY
)

message(NOTICE "p -> p")
execute_process(COMMAND @CMAKE_BINARY_DIR@/apps/openssl pkcs7 -in p7d-f.p -inform p -outform p
                WORKING_DIRECTORY @CMAKE_CURRENT_BINARY_DIR@
                OUTPUT_FILE p7d-ff.p3
                COMMAND_ERROR_IS_FATAL ANY
)

# not tested. File is actually different.
# execute_process(COMMAND @CMAKE_COMMAND@ -E compare_files --ignore-eol p7d-fff.p p7d-f.p
#                 WORKING_DIRECTORY @CMAKE_CURRENT_BINARY_DIR@
#                 COMMAND_ERROR_IS_FATAL ANY
# )

execute_process(COMMAND @CMAKE_COMMAND@ -E compare_files --ignore-eol p7d-f.p p7d-ff.p1
                WORKING_DIRECTORY @CMAKE_CURRENT_BINARY_DIR@
                COMMAND_ERROR_IS_FATAL ANY
)

execute_process(COMMAND @CMAKE_COMMAND@ -E compare_files --ignore-eol p7d-f.p p7d-ff.p3
                WORKING_DIRECTORY @CMAKE_CURRENT_BINARY_DIR@
                COMMAND_ERROR_IS_FATAL ANY
)

# Have stopped pretending? The duplicated judgement has gone?

# ... I think following are correct, isn't it? -- Fsu0413

execute_process(COMMAND @CMAKE_COMMAND@ -E compare_files --ignore-eol p7d-f.d p7d-ff.d1
         WORKING_DIRECTORY @CMAKE_CURRENT_BINARY_DIR@
         COMMAND_ERROR_IS_FATAL ANY
)

execute_process(COMMAND @CMAKE_COMMAND@ -E compare_files --ignore-eol p7d-f.d p7d-ff.d3
         WORKING_DIRECTORY @CMAKE_CURRENT_BINARY_DIR@
         COMMAND_ERROR_IS_FATAL ANY
)

execute_process(COMMAND @CMAKE_COMMAND@ -E rm -f p7d-fff.p p7d-f.d p7d-f.p p7d-ff.d1 p7d-ff.d3 p7d-ff.p1 p7d-ff.p3
                WORKING_DIRECTORY @CMAKE_CURRENT_BINARY_DIR@
)
